2026-02-09 22:32:17 | INFO | processor | Clean + cast products
2026-02-09 22:32:18 | ERROR | processor | Processor failed: Column is not iterable
Traceback (most recent call last):
  File "/opt/spark-app/src/jobs/processor.py", line 54, in main
    p_df = validate_products(p_df, allowed)
  File "/opt/spark-app/src/common/validation.py", line 19, in validate_products
    ), F.lit(None))
  File "/spark/python/lib/pyspark.zip/pyspark/sql/functions.py", line 2134, in array_remove
    return Column(sc._jvm.functions.array_remove(_to_java_column(col), element))
  File "/spark/python/lib/py4j-0.10.9-src.zip/py4j/java_gateway.py", line 1296, in __call__
    args_command, temp_args = self._build_args(*args)
  File "/spark/python/lib/py4j-0.10.9-src.zip/py4j/java_gateway.py", line 1260, in _build_args
    (new_args, temp_args) = self._get_args(args)
  File "/spark/python/lib/py4j-0.10.9-src.zip/py4j/java_gateway.py", line 1247, in _get_args
    temp_arg = converter.convert(arg, self.gateway_client)
  File "/spark/python/lib/py4j-0.10.9-src.zip/py4j/java_collections.py", line 510, in convert
    for element in object:
  File "/spark/python/lib/pyspark.zip/pyspark/sql/column.py", line 353, in __iter__
    raise TypeError("Column is not iterable")
TypeError: Column is not iterable
2026-02-09 22:35:22 | INFO | processor | Clean + cast products
2026-02-09 22:35:24 | INFO | processor | cache() produits valides (Spark UI > Storage)
2026-02-09 22:35:45 | INFO | processor | Clean + cast stocks + filter AAPL
2026-02-09 22:35:46 | INFO | processor | persist(MEMORY_AND_DISK) stocks valides (Spark UI > Storage)
2026-02-09 22:35:48 | INFO | processor | Aggregation produits (par année de sortie et catégorie)
2026-02-09 22:35:48 | INFO | processor | Aggregation stocks (mensuel)
2026-02-09 22:35:48 | INFO | processor | Aggregation stocks (annuel) pour corrélation
2026-02-09 22:35:48 | INFO | processor | JOIN produits (year_event, category) avec stocks (year_event)
2026-02-09 22:36:15 | INFO | processor | Processor OK.
2026-02-10 20:24:31 | ERROR | processor | Processor failed: Table or view not found: apple_platform.raw_apple_products;;
'UnresolvedRelation [apple_platform, raw_apple_products]
Traceback (most recent call last):
  File "/opt/spark-app/src/jobs/processor.py", line 38, in main
    products_raw = spark.table(f"{args.hive_db}.raw_apple_products")
  File "/spark/python/lib/pyspark.zip/pyspark/sql/session.py", line 659, in table
    return DataFrame(self._jsparkSession.table(tableName), self._wrapped)
  File "/spark/python/lib/py4j-0.10.9-src.zip/py4j/java_gateway.py", line 1305, in __call__
    answer, self.gateway_client, self.target_id, self.name)
  File "/spark/python/lib/pyspark.zip/pyspark/sql/utils.py", line 137, in deco
    raise_from(converted)
  File "<string>", line 3, in raise_from
pyspark.sql.utils.AnalysisException: Table or view not found: apple_platform.raw_apple_products;;
'UnresolvedRelation [apple_platform, raw_apple_products]

2026-02-10 20:37:39 | INFO | processor | Clean + cast products
2026-02-10 20:37:40 | INFO | processor | cache() produits valides (Spark UI > Storage)
2026-02-10 20:37:58 | INFO | processor | Clean + cast stocks + filter AAPL
2026-02-10 20:37:58 | INFO | processor | persist(MEMORY_AND_DISK) stocks valides (Spark UI > Storage)
2026-02-10 20:38:00 | INFO | processor | Aggregation produits (par année de sortie et catégorie)
2026-02-10 20:38:00 | INFO | processor | Aggregation stocks (mensuel)
2026-02-10 20:38:00 | INFO | processor | Aggregation stocks (annuel) pour corrélation
2026-02-10 20:38:00 | INFO | processor | JOIN produits (year_event, category) avec stocks (year_event)
2026-02-10 20:38:23 | INFO | processor | Processor OK.
2026-02-11 11:13:01 | INFO | processor | Clean + cast products
2026-02-11 11:13:02 | INFO | processor | cache() produits valides (Spark UI > Storage)
2026-02-11 11:13:21 | INFO | processor | Clean + cast stocks + filter AAPL
2026-02-11 11:13:21 | INFO | processor | persist(MEMORY_AND_DISK) stocks valides (Spark UI > Storage)
2026-02-11 11:13:22 | INFO | processor | Aggregation produits (par année de sortie et catégorie)
2026-02-11 11:13:22 | INFO | processor | Aggregation stocks (mensuel)
2026-02-11 11:13:22 | INFO | processor | Aggregation stocks (annuel) pour corrélation
2026-02-11 11:13:22 | INFO | processor | JOIN produits (year_event, category) avec stocks (year_event)
2026-02-11 11:14:38 | INFO | processor | Processor OK.
2026-02-11 16:10:28 | INFO | processor | Clean + cast products
2026-02-11 16:10:29 | INFO | processor | cache() produits valides (Spark UI > Storage)
2026-02-11 16:10:41 | INFO | processor | Clean + cast stocks + filter AAPL
2026-02-11 16:10:41 | INFO | processor | persist(MEMORY_AND_DISK) stocks valides (Spark UI > Storage)
2026-02-11 16:10:42 | INFO | processor | Aggregation produits (par année de sortie et catégorie)
2026-02-11 16:10:42 | INFO | processor | Aggregation stocks (mensuel)
2026-02-11 16:10:42 | INFO | processor | Aggregation stocks (annuel) pour corrélation
2026-02-11 16:10:42 | INFO | processor | JOIN produits (year_event, category) avec stocks (year_event)
2026-02-11 16:11:47 | INFO | processor | Processor OK.
2026-02-11 19:50:31 | INFO | processor | Clean + cast products
2026-02-11 19:50:33 | INFO | processor | cache() produits valides (Spark UI > Storage)
2026-02-11 19:50:50 | INFO | processor | Clean + cast stocks + filter AAPL
2026-02-11 19:50:50 | INFO | processor | persist(MEMORY_AND_DISK) stocks valides (Spark UI > Storage)
2026-02-11 19:50:51 | INFO | processor | Aggregation produits (par année de sortie et catégorie)
2026-02-11 19:50:52 | INFO | processor | Aggregation stocks (mensuel)
2026-02-11 19:50:52 | INFO | processor | Aggregation stocks (annuel) pour corrélation
2026-02-11 19:50:52 | INFO | processor | JOIN produits (year_event, category) avec stocks (year_event)
2026-02-11 19:52:11 | INFO | processor | Processor OK.
2026-02-12 16:11:28 | INFO | processor | Clean + cast products
2026-02-12 16:11:29 | INFO | processor | cache() produits valides (Spark UI > Storage)
2026-02-12 16:11:44 | INFO | processor | Clean + cast stocks + filter AAPL
2026-02-12 16:11:44 | INFO | processor | persist(MEMORY_AND_DISK) stocks valides (Spark UI > Storage)
2026-02-12 16:11:45 | INFO | processor | Aggregation produits (par année de sortie et catégorie)
2026-02-12 16:11:46 | INFO | processor | Aggregation stocks (mensuel)
2026-02-12 16:11:46 | INFO | processor | Aggregation stocks (annuel) pour corrélation
2026-02-12 16:11:46 | INFO | processor | JOIN produits (year_event, category) avec stocks (year_event)
2026-02-12 16:12:54 | INFO | processor | Processor OK.
2026-02-12 17:02:21 | INFO | processor | Clean + cast products
2026-02-12 17:02:22 | INFO | processor | cache() produits valides (Spark UI > Storage)
2026-02-12 17:02:36 | INFO | processor | Clean + cast stocks + filter AAPL
2026-02-12 17:02:36 | INFO | processor | persist(MEMORY_AND_DISK) stocks valides (Spark UI > Storage)
2026-02-12 17:02:37 | INFO | processor | Aggregation produits (par année de sortie et catégorie)
2026-02-12 17:02:37 | INFO | processor | Aggregation stocks (mensuel)
2026-02-12 17:02:37 | INFO | processor | Aggregation stocks (annuel) pour corrélation
2026-02-12 17:02:37 | INFO | processor | JOIN produits (year_event, category) avec stocks (year_event)
2026-02-12 17:03:42 | INFO | processor | Processor OK.
